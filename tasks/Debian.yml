---
  
- name: Install Linux Headers
  apt: 
    name: linux-headers-{{ ansible_kernel }}
    state: present
    update_cache: yes
    cache_valid_time: 43200

- block:
  - name: Add Draios GPG key
    apt_key:
      url: "{{ sysdig_gpg_key_url }}"

  - name: Get Draios repository source line
    uri:
      url: "{{ sysdig_deb_url }}"
      return_content: yes
    register: repo_str

  - name: Add source line to apt sources
    apt_repository:
      repo: "{{ repo_str.content.strip() }}"
      filename: draios


  - name: Install sysdig
    apt:
      name: sysdig
      state: present

  when: sysdig_install_type == "traditional"


- block:
  - name: pull sysdig image
    command: docker pull sysdig/sysdig

  when: sysdig_install_type == "container"
